spark.sql.catalogImplementation hive

spark.master                     spark://dx-master:7077
spark.eventLog.enabled           true
spark.eventLog.dir               hdfs://dx-master:8020/spark-logs
spark.serializer                 org.apache.spark.serializer.JavaSerializer
# spark.serializer                 org.apache.spark.serializer.KryoSerializer
spark.sql.warehouse.dir          hdfs://dx-master:8020/user/hive/warehouse
spark.driver.bindAddress         0.0.0.0
spark.driver.host                dx-master
# Resource allocation
spark.executor.memory            1g
spark.executor.cores             1
spark.driver.memory              2g
spark.driver.maxResultSize       1.5g

# Hive integration - Fixed for 3.1.3
spark.sql.hive.metastore.version 3.1.3
spark.sql.hive.metastore.jars    path
spark.sql.hive.metastore.jars.path /dxhouse/hive/lib/*
spark.sql.hive.metastore.uris    thrift://dx-master:9083

# # Add Hive JARs to Spark classpath for Hive-on-Spark
# spark.driver.extraClassPath      /dxhouse/hive/lib/*:/dxhouse/hadoop/share/hadoop/common/*:/dxhouse/hadoop/share/hadoop/common/lib/*
# spark.executor.extraClassPath    /dxhouse/hive/lib/*:/dxhouse/hadoop/share/hadoop/common/*:/dxhouse/hadoop/share/hadoop/common/lib/*

# Increase RPC timeout
spark.hadoop.ipc.client.connect.timeout           60000
spark.hadoop.ipc.client.connect.max.retries       10

# Iceberg configuration - UPDATED for Java 8 compatible version
spark.sql.extensions            org.apache.iceberg.spark.extensions.IcebergSparkSessionExtensions
spark.sql.catalog.spark_catalog  org.apache.iceberg.spark.SparkSessionCatalog
spark.sql.catalog.spark_catalog.type hive
spark.sql.catalog.local          org.apache.iceberg.spark.SparkCatalog
spark.sql.catalog.local.type     hadoop
spark.sql.catalog.local.warehouse hdfs://dx-master:8020/user/hive/warehouse

# UPDATED: Use Java 8 compatible Iceberg JAR
spark.jars                       /dxhouse/iceberg/iceberg-spark-runtime-3.4_2.12-1.3.1.jar

# Single node optimizations
spark.sql.adaptive.enabled      true
spark.sql.adaptive.coalescePartitions.enabled true
spark.serializer.objectStreamReset 100

# Serialization optimizations for network
spark.kryo.unsafe                true
spark.kryo.referenceTracking     false
spark.kryo.registrationRequired  false
spark.rdd.compress               true
spark.io.compression.codec       snappy

# Dynamic allocation
spark.dynamicAllocation.enabled  true
spark.dynamicAllocation.minExecutors 1
spark.dynamicAllocation.maxExecutors 3

# Hive-specific Spark configurations
spark.sql.legacy.createHiveTableByDefault.enabled true
spark.sql.hive.convertMetastoreOrc true
spark.sql.hive.convertMetastoreParquet true
spark.sql.orc.impl               native
spark.sql.orc.enableVectorizedReader true